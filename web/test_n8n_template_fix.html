<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>üîß N8N Template Fix Test</title>
    <style>
        body {
            font-family: Arial;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }

        .success {
            background: #d4edda;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .warning {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .error {
            background: #f8d7da;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>üîß N8N Template Syntax Fix</h2>

        <div class="error">
            <h4>‚ùå SYNTAX C≈® (KH√îNG HO·∫†T ƒê·ªòNG):</h4>
            <div class="code">
                Xin ch√†o {{ $node["Webhook"].json["userName"] }}!<br>
                B√°c sƒ©: {{ $node["Webhook"].json["doctorName"] }}<br>
                Ng√†y kh√°m: {{ $node["Webhook"].json["appointmentDate"] }}<br>
                S·ªë ti·ªÅn: {{ $node["Webhook"].json["formattedAmount"] }}
            </div>
        </div>

        <div class="success">
            <h4>‚úÖ SYNTAX M·ªöI (ƒê√öNG):</h4>
            <div class="code">
                Xin ch√†o {{ $json.userName }}!<br>
                B√°c sƒ©: {{ $json.doctorName }}<br>
                Ng√†y kh√°m: {{ $json.appointmentDate }}<br>
                S·ªë ti·ªÅn: {{ $json.formattedAmount }}
            </div>
        </div>

        <div class="warning">
            <h4>üîÑ C√ÅC B∆Ø·ªöC FIX N8N:</h4>
            <ol>
                <li><strong>M·ªü N8N Workflow</strong> ‚Üí kinggg123.app.n8n.cloud</li>
                <li><strong>Ch·ªânh s·ª≠a HTML Node</strong> ho·∫∑c Gmail Node</li>
                <li><strong>Thay ALL template syntax</strong> t·ª´ c≈© sang m·ªõi</li>
                <li><strong>Test workflow</strong> b·∫±ng c√°ch g·ª≠i webhook</li>
                <li><strong>Ki·ªÉm tra email</strong> ‚Üí ph·∫£i hi·ªÉn th·ªã data th·∫≠t</li>
            </ol>
        </div>

        <div class="success">
            <h4>üìß EMAIL TEMPLATE HO√ÄN CH·ªàNH:</h4>
            <div class="code">
                &lt;!DOCTYPE html&gt;<br>
                &lt;html&gt;<br>
                &lt;head&gt;<br>
                &nbsp;&nbsp;&lt;meta charset="UTF-8"&gt;<br>
                &nbsp;&nbsp;&lt;title&gt;X√°c nh·∫≠n thanh to√°n&lt;/title&gt;<br>
                &lt;/head&gt;<br>
                &lt;body&gt;<br>
                &nbsp;&nbsp;&lt;h2&gt;üéâ Thanh to√°n th√†nh c√¥ng!&lt;/h2&gt;<br>
                &nbsp;&nbsp;&lt;p&gt;Xin ch√†o &lt;strong&gt;{{ $json.userName }}&lt;/strong&gt;,&lt;/p&gt;<br>
                &nbsp;&nbsp;<br>
                &nbsp;&nbsp;&lt;div style="background: #d4edda; padding: 15px; border-radius: 5px;"&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;h3&gt;üí∞ TH√îNG TIN THANH TO√ÅN&lt;/h3&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;strong&gt;S·ªë ti·ªÅn:&lt;/strong&gt; {{ $json.formattedAmount
                }}&lt;/p&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;strong&gt;M√£ h√≥a ƒë∆°n:&lt;/strong&gt; {{ $json.billId
                }}&lt;/p&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;strong&gt;SƒêT:&lt;/strong&gt; {{ $json.userPhone }}&lt;/p&gt;<br>
                &nbsp;&nbsp;&lt;/div&gt;<br>
                &nbsp;&nbsp;<br>
                &nbsp;&nbsp;&lt;div style="background: #e7f3ff; padding: 15px; border-radius: 5px;"&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;h3&gt;üìÖ TH√îNG TIN CU·ªòC H·∫∏N&lt;/h3&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;strong&gt;B√°c sƒ©:&lt;/strong&gt; {{ $json.doctorName
                }}&lt;/p&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;strong&gt;Ng√†y kh√°m:&lt;/strong&gt; {{ $json.appointmentDate
                }}&lt;/p&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;strong&gt;Gi·ªù kh√°m:&lt;/strong&gt; {{ $json.appointmentTime
                }}&lt;/p&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;strong&gt;D·ªãch v·ª•:&lt;/strong&gt; {{ $json.serviceName
                }}&lt;/p&gt;<br>
                &nbsp;&nbsp;&lt;/div&gt;<br>
                &nbsp;&nbsp;<br>
                &nbsp;&nbsp;&lt;p&gt;C·∫£m ∆°n b·∫°n ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª•!&lt;/p&gt;<br>
                &lt;/body&gt;<br>
                &lt;/html&gt;
            </div>
        </div>

        <div class="warning">
            <h4>üß™ TEST N8N:</h4>
            <button onclick="testN8nWebhook()"
                style="background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                üß™ Test N8N Webhook
            </button>
            <div id="testResult" style="margin-top: 10px;"></div>
        </div>

        <div class="error">
            <h4>üö® L∆ØU √ù:</h4>
            <ul>
                <li><strong>N8N ph·∫£i d√πng syntax m·ªõi:</strong> {{ $json.fieldName }}</li>
                <li><strong>Ki·ªÉm tra HTML Node</strong> trong workflow</li>
                <li><strong>Test b·∫±ng webhook th·∫≠t</strong> t·ª´ Java backend</li>
                <li><strong>Reset anti-spam</strong> n·∫øu c·∫ßn: <a href="/TestFull/reset_antispam.jsp?action=reset">Reset
                        cache</a></li>
            </ul>
        </div>
    </div>

    <script>
        function testN8nWebhook() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<div class="warning">üîÑ ƒêang g·ª≠i test webhook...</div>';

            // Test data gi·ªëng nh∆∞ backend Java g·ª≠i
            const testData = {
                type: "payment_success",
                to: "test@example.com",
                userName: "PhuocTHDev TEST",
                userPhone: "0123456789",
                doctorEmail: "doctor@clinic.vn",
                doctorName: "B√°c sƒ© Nguy·ªÖn VƒÉn A",
                appointmentDate: "2025-01-15",
                appointmentTime: "09:00 - 10:00",
                serviceName: "B·ªçc rƒÉng s·ª©",
                billId: "BILL_TEST_123",
                orderId: "ORDER_TEST_456",
                billAmount: 2000000,
                formattedAmount: "2.000.000 VNƒê",
                clinicName: "Ph√≤ng kh√°m Nha khoa",
                clinicAddress: "123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM",
                clinicPhone: "028-1234-5678",
                timestamp: new Date().toISOString()
            };

            fetch('https://kinggg123.app.n8n.cloud/webhook/send-appointment-email', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(testData)
            })
                .then(response => {
                    if (response.ok) {
                        resultDiv.innerHTML = '<div class="success">‚úÖ Test webhook g·ª≠i th√†nh c√¥ng! Ki·ªÉm tra email ƒë·ªÉ xem template c√≥ render ƒë√∫ng kh√¥ng.</div>';
                    } else {
                        resultDiv.innerHTML = '<div class="error">‚ùå Test webhook th·∫•t b·∫°i: ' + response.status + '</div>';
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML = '<div class="error">‚ùå L·ªói: ' + error.message + '</div>';
                });
        }
    </script>
</body>

</html>