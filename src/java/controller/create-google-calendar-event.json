{
  "name": "create-google-calendar-event",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "create-google-calendar-event",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -220,
        0
      ],
      "id": "calendar-webhook",
      "name": "Calendar Webhook",
      "webhookId": "calendar-webhook-id"
    },
    {
      "parameters": {
        "jsCode": "// Láº¤Y Dá»® LIá»†U Tá»ª WEBHOOK\nconst data = $json.body;\n\nconsole.log('ðŸ“… === GOOGLE CALENDAR WEBHOOK ===');\nconsole.log('ðŸ“¥ Raw Data:', JSON.stringify(data, null, 2));\nconsole.log('ðŸ• Start DateTime:', data.startDateTime);\nconsole.log('ðŸ• End DateTime:', data.endDateTime);\nconsole.log('ðŸ“§ User Email:', data.userEmail);\nconsole.log('ðŸ“§ Doctor Email:', data.doctorEmail);\n\n// KIá»‚M TRA Dá»® LIá»†U Báº®T BUá»˜C\nif (!data.startDateTime || !data.endDateTime) {\n  console.error('âŒ THIáº¾U DATETIME:', {\n    startDateTime: data.startDateTime,\n    endDateTime: data.endDateTime\n  });\n  throw new Error('Missing startDateTime or endDateTime from Java backend');\n}\n\nif (!data.userEmail || !data.doctorEmail) {\n  console.error('âŒ THIáº¾U EMAIL:', {\n    userEmail: data.userEmail,\n    doctorEmail: data.doctorEmail\n  });\n  throw new Error('Missing email addresses');\n}\n\n// Táº O CALENDAR EVENT OBJECT\nconst calendarEvent = {\n  summary: data.eventTitle || `ðŸ¦· ${data.serviceName || 'Dá»‹ch vá»¥ nha khoa'} - ${data.userName || 'Bá»‡nh nhÃ¢n'}`,\n  description: `ðŸ¥ THÃ”NG TIN CUá»˜C Háº¸N CHI TIáº¾T\\n\\nðŸ“‹ Dá»‹ch vá»¥: ${data.serviceName || 'N/A'}\\nðŸ‘¤ Bá»‡nh nhÃ¢n: ${data.userName || 'N/A'}\\nðŸ“ž Sá»‘ Ä‘iá»‡n thoáº¡i: ${data.userPhone || 'N/A'}\\nðŸ‘¨â€âš•ï¸ BÃ¡c sÄ© phá»¥ trÃ¡ch: ${data.doctorName || 'N/A'}\\n\\nðŸ“… NgÃ y khÃ¡m: ${data.appointmentDate || 'N/A'}\\nâ° Giá» khÃ¡m: ${data.appointmentTime || 'N/A'}\\nðŸ“ Äá»‹a Ä‘iá»ƒm: ${data.location || 'FPT University ÄÃ  Náºµng'}\\n\\nðŸ’° THÃ”NG TIN THANH TOÃN\\nðŸ’µ Sá»‘ tiá»n: ${data.formattedAmount || 'N/A'}\\nðŸ§¾ MÃ£ hÃ³a Ä‘Æ¡n: ${data.billId || 'N/A'}\\n\\nðŸ¥ THÃ”NG TIN PHÃ’NG KHÃM\\nðŸ¢ TÃªn: PhÃ²ng khÃ¡m Nha khoa DentalClinic\\nðŸ“ Äá»‹a chá»‰: ${data.location || 'FPT University ÄÃ  Náºµng'}\\nðŸ“ž Hotline: 0936929382\\n\\nðŸ“ LÆ¯U Ã QUAN TRá»ŒNG:\\nâ€¢ Vui lÃ²ng Ä‘áº¿n trÆ°á»›c giá» háº¹n 15 phÃºt\\nâ€¢ Mang theo CCCD/CMND vÃ  sá»• khÃ¡m bá»‡nh (náº¿u cÃ³)\\nâ€¢ LiÃªn há»‡ hotline náº¿u cáº§n thay Ä‘á»•i lá»‹ch háº¹n\\n\\nâœ… Lá»‹ch háº¹n nÃ y Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c nháº­n vÃ  thanh toÃ¡n thÃ nh cÃ´ng!`,\n  start: {\n    dateTime: data.startDateTime,\n    timeZone: 'Asia/Ho_Chi_Minh'\n  },\n  end: {\n    dateTime: data.endDateTime,\n    timeZone: 'Asia/Ho_Chi_Minh'\n  },\n  location: data.location || 'FPT University ÄÃ  Náºµng',\n  attendees: data.attendees || [\n    { email: data.userEmail, displayName: data.userName },\n    { email: data.doctorEmail, displayName: data.doctorName }\n  ],\n  reminders: {\n    useDefault: false,\n    overrides: [\n      { method: 'email', minutes: 1440 }, // 1 day before\n      { method: 'popup', minutes: 30 }    // 30 minutes before\n    ]\n  }\n};\n\nconsole.log('ðŸ“… === FINAL CALENDAR EVENT ===');\nconsole.log('ðŸ“ Summary:', calendarEvent.summary);\nconsole.log('ðŸ• Start:', calendarEvent.start.dateTime);\nconsole.log('ðŸ• End:', calendarEvent.end.dateTime);\nconsole.log('ðŸ“ Location:', calendarEvent.location);\nconsole.log('ðŸ‘¥ Attendees:', JSON.stringify(calendarEvent.attendees));\nconsole.log('ðŸ“‹ Description length:', calendarEvent.description.length, 'characters');\nconsole.log('ðŸ”” Reminders:', JSON.stringify(calendarEvent.reminders));\n\n// RETURN CALENDAR EVENT\nreturn [{ json: calendarEvent }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        0
      ],
      "id": "process-calendar-data",
      "name": "Process Calendar Data"
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "de180577tranhongphuoc@gmail.com",
          "mode": "list",
          "cachedResultName": "de180577tranhongphuoc@gmail.com"
        },
        "start": "={{$json.start}}",
        "end": "={{$json.end}}",
        "additionalFields": {
          "attendees": "={{$json.attendees}}",
          "description": "={{$json.description}}",
          "location": "={{$json.location}}",
          "summary": "={{$json.summary}}",
          "reminders": "={{$json.reminders}}"
        }
      },
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.3,
      "position": [
        220,
        0
      ],
      "id": "create-calendar-event",
      "name": "Create Calendar Event",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "V5ACSjdT1n29E2kl",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={ \"success\": true, \"message\": \"Google Calendar event created successfully\", \"eventId\": $json.id, \"eventLink\": $json.htmlLink, \"summary\": $json.summary, \"start\": $json.start.dateTime, \"end\": $json.end.dateTime, \"attendees\": $json.attendees?.map(a => a.email) || [], \"timestamp\": new Date().toISOString() }",
        "options": {
          "responseCode": 200
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        440,
        0
      ],
      "id": "calendar-response",
      "name": "Calendar Response"
    }
  ],
  "connections": {
    "Calendar Webhook": {
      "main": [
        [
          {
            "node": "Process Calendar Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Calendar Data": {
      "main": [
        [
          {
            "node": "Create Calendar Event",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Calendar Event": {
      "main": [
        [
          {
            "node": "Calendar Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "id": "calendar-workflow-new",
  "tags": ["calendar", "google", "dental-clinic"]
} 